[
  {
    "_id": "service_now_cmdb_enrichment",
    "name": "ServiceNow CMDB Enrichment",
    "description": "",
    "type": "playbook",
    "category": "ServiceNow",
    "version": 1,
    "enabled": true,
    "onlyWarehouse": false
  },
  {
    "_id": "e94786c5-ef5d-46c1-993f-a2e2c288ea03",
    "name": "Start",
    "shortname": "root",
    "type": "root_node",
    "playbook": "service_now_cmdb_enrichment",
    "errorStatus": "fail",
    "arguments": "{ \"tables\" : { \"inputType\" : \"prompt\", \"schema\" : { \"type\" : \"array\", \"default\" : [\"cmdb_ci_database\"] }, \"required\" : true, \"sensitive\" : false, \"contextVariable\" : false, \"alwaysPrompt\" : false }, \"limit\" : { \"inputType\" : \"prompt\", \"schema\" : { \"type\" : \"number\", \"description\" : \"Limit for how many tickets to retrieve\", \"default\" : 1000 }, \"required\" : false, \"sensitive\" : false, \"contextVariable\" : false, \"alwaysPrompt\" : false }, \"service_now_asset_id\" : { \"inputType\" : \"prompt\", \"required\" : true, \"sensitive\" : false, \"contextVariable\" : false, \"alwaysPrompt\" : false } }",
    "children": [
      "7d5e2ad6-3f5e-4f3d-9f8f-67a239533d48"
    ]
  },
  {
    "_id": "7d5e2ad6-3f5e-4f3d-9f8f-67a239533d48",
    "name": "Drop servicenow_cmdb_table_data collection",
    "shortname": "drop_servicenow_cmdb_table_data_collection",
    "type": "action_node",
    "playbook": "service_now_cmdb_enrichment",
    "errorStatus": "warn",
    "arguments": "{ \"requestBody\" : { \"inputType\" : \"prompt\", \"schema\" : { \"type\" : \"object\", \"description\" : \"The action's parameters contained in the request data.\", \"extensions\" : { \"in\" : \"body\", \"mediaType\" : \"application/json\" }, \"required\" : [\"commands\"], \"properties\" : { \"commands\" : { \"type\" : \"array\", \"description\" : \"The list of command documents to run must be formatted like {\\\"command\\\": <\\\"some command\\\">, value: <value>, database_name: <db_name>, \\\"additional_parameters\\\": {arg1: <value>, arg2: <value>} }\", \"extensions\" : { \"parent\" : \"requestBody\" }, \"items\" : { } } } }, \"required\" : false, \"expanded\" : true, \"sensitive\" : false }, \"asset_id\" : { \"inputType\" : \"literal\", \"schema\" : { \"type\" : \"string\", \"description\" : \"The asset ID of the MongoDB server.\", \"extensions\" : { \"in\" : \"query\" } }, \"required\" : true, \"sensitive\" : false, \"value\" : \"\\\"lmrm__sonarw\\\"\" }, \"commands\" : { \"inputType\" : \"bind\", \"schema\" : { \"type\" : \"array\", \"description\" : \"The list of command documents to run must be formatted like {\\\"command\\\": <\\\"some command\\\">, value: <value>, database_name: <db_name>, \\\"additional_parameters\\\": {arg1: <value>, arg2: <value>} }\", \"extensions\" : { \"parent\" : \"requestBody\" }, \"items\" : { } }, \"required\" : true, \"sensitive\" : false, \"runAsProject\" : false, \"expression\" : \"[ { \\\"command\\\" : \\\"drop\\\", \\\"value\\\" : \\\"servicenow_cmdb_table_data\\\", \\\"database_name\\\" : \\\"sonargd\\\" } ]\" } }",
    "result": "{ \"schema\" : { \"type\" : \"object\", \"description\" : \"Action completed\", \"properties\" : { \"message\" : { \"type\" : \"string\", \"description\" : \"A message informing the update success and if any document was updated.\" }, \"output\" : { \"type\" : \"string\", \"description\" : \"A dictionary of commands and their output\" } } }, \"sensitive\" : false, \"expression\" : \"\" }",
    "children": [
      "7274fc1e-0ead-4e87-b560-6fc23896dd0d"
    ],
    "action": "actions:sonaractions.mongodb_actions_run_mongodb_commands",
    "asynchronous": false
  },
  {
    "_id": "7274fc1e-0ead-4e87-b560-6fc23896dd0d",
    "name": "Loop over table names",
    "shortname": "loop",
    "type": "loop_node",
    "playbook": "service_now_cmdb_enrichment",
    "errorStatus": "fail",
    "arguments": "{ \"items\" : { \"inputType\" : \"bind\", \"schema\" : { \"type\" : \"array\" }, \"required\" : false, \"sensitive\" : false, \"runAsProject\" : false, \"expression\" : \"\\\"$root.arguments.tables\\\"\" } }",
    "children": [
      "b188a935-7f3d-4e98-a78c-5a3893ea9bbf"
    ],
    "end": [
      "0036c6f8-de38-4fc3-9944-153f1a23ae77"
    ]
  },
  {
    "_id": "b188a935-7f3d-4e98-a78c-5a3893ea9bbf",
    "name": "Servicenow Query Table",
    "shortname": "query_table",
    "type": "action_node",
    "playbook": "service_now_cmdb_enrichment",
    "errorStatus": "fail",
    "arguments": "{ \"url\" : { \"inputType\" : \"literal\", \"schema\" : { \"type\" : \"string\", \"description\" : \"{url}/api/now - will be overwritten with asset_id connection 'url' field\", \"default\" : \"https://demo.servicenow.com\", \"extensions\" : { \"in\" : \"server\" } }, \"required\" : true, \"sensitive\" : false, \"value\" : \"\\\"<asset_url>\\\"\" }, \"tableName\" : { \"inputType\" : \"bind\", \"schema\" : { \"type\" : \"string\", \"description\" : \"Name of the table from which to retrieve the records.\", \"extensions\" : { \"in\" : \"path\" } }, \"required\" : true, \"sensitive\" : false, \"runAsProject\" : false, \"expression\" : \"\\\"$loop.item\\\"\" }, \"sysparm_display_value\" : { \"inputType\" : \"literal\", \"schema\" : { \"type\" : \"string\", \"description\" : \"Determines the type of data returned, either the actual values from the database or the display values of the fields. Display values are manipulated based on the actual value in the database and user or system settings and preferences.\\nIf returning display values, the value that is returned is dependent on the field type.\\n- Choice fields: The database value may be a number, but the display value will be more descriptive.\\n- Date fields: The database value is in UTC format, while the display value is based on the user's time zone.\\n- Encrypted text: The database value is encrypted, while the displayed value is unencrypted based on the user's encryption context.\\n- Reference fields: The database value is sys_id, but the display value is a display field of the referenced record.\\n\\nValid values:\\n    true: Returns the display values for all fields.\\n    false: Returns the actual values from the database.\\n    all: Returns both actual and display values.\\n\\nNote: There is no preferred method for setting this parameter. However, specifying the display value may cause performance issues since it is not reading directly from the database and may include referencing other fields and records. For more information on display values and actual values, see Table API FAQs (KB0534905).\", \"default\" : \"false\", \"extensions\" : { \"in\" : \"query\" } }, \"required\" : false, \"sensitive\" : false, \"value\" : \"\\\"true\\\"\" }, \"sysparm_fields\" : { \"inputType\" : \"literal\", \"schema\" : { \"type\" : \"string\", \"description\" : \"Comma-separated list of fields to return in the response.\", \"extensions\" : { \"in\" : \"query\" } }, \"required\" : false, \"sensitive\" : false, \"value\" : \"\\\"sys_id,subcategory,managed_by_group,managed_by,support_group,supported_by,name,department,ip_address,category,fqdn\\\"\" }, \"sysparm_limit\" : { \"inputType\" : \"bind\", \"schema\" : { \"type\" : \"number\", \"description\" : \"Maximum number of records to return. For requests that exceed this number of records, use the sysparm_offset parameter to paginate record retrieval.\\n\\nThis limit is applied before ACL evaluation. If no records return, including records you have access to, rearrange the record order so records you have access to return first.\\n\\nNote: Unusually large sysparm_limit values can impact system performance.\", \"default\" : 1000, \"extensions\" : { \"in\" : \"query\" } }, \"required\" : false, \"sensitive\" : false, \"runAsProject\" : false, \"expression\" : \"\\\"$root.arguments.limit\\\"\" }, \"sysparm_query\" : { \"inputType\" : \"literal\", \"schema\" : { \"type\" : \"string\", \"description\" : \"Encoded query used to filter the result set. You can use a UI filter to obtain a properly encoded query.\\nSyntax: sysparm_query=.\\n\\n    : Name of the table column to filter against.\\n    : Supports the following values:\\n        =: Exactly matches .\\n        !=: Does not match .\\n        ^: Logically AND multiple query statements.\\n        ^OR: Logically OR multiple query statements.\\n        LIKE:  contains the specified string. Only works for  fields whose data type is string.\\n        STARTSWITH:  starts with the specified string. Only works for  fields whose data type is string.\\n        ENDSWITH:  ends with the specified string. Only works for  fields whose data type is string.\\n    : Value to match against.\\n\\nAll parameters are case-sensitive. Queries can contain more than one entry, such as sysparm_query=[].\\n\\nFor example:\\n\\n(sysparm_query=caller_id=javascript:gs.getUserID()^active=true)\\n\\nEncoded queries also support order by functionality. To sort responses based on certain fields, use the ORDERBY and ORDERBYDESC clauses in sysparm_query.\\nSyntax:\\n\\n    ORDERBY\\n    ORDERBYDESC\\n\\nFor example: sysparm_query=active=true^ORDERBYnumber^ORDERBYDESCcategory\\n\\nThis query filters all active records and orders the results in ascending order by number, and then in descending order by category.\\nIf part of the query is invalid, such as by specifying an invalid field name, the instance ignores the invalid part. It then returns rows using only the valid portion of the query. You can control this behavior using the property glide.invalid_query.returns_no_rows. Set this property to true to return no rows on an invalid query.\\nNote: The glide.invalid_query.returns_no_rows property controls the behavior of all queries across the instance, such as in lists, scripts (GlideRecord.query()), and web service APIs.\", \"extensions\" : { \"in\" : \"query\" } }, \"required\" : false, \"sensitive\" : false, \"value\" : \"\\\"nameLIKEISBT\\\"\" }, \"BasicAuth\" : { \"inputType\" : \"bind\", \"schema\" : { \"type\" : \"string\", \"description\" : \"The asset_id of the connection that matches type:OPENAPI and auth_mechanism:basic\", \"extensions\" : { \"in\" : \"header\" } }, \"required\" : true, \"sensitive\" : false, \"runAsProject\" : false, \"expression\" : \"\\\"$root.arguments.service_now_asset_id\\\"\" } }",
    "result": "{ \"schema\" : { }, \"sensitive\" : false, \"expression\" : \"\" }",
    "children": [
      "51401d50-f473-4e00-9538-f7ed329200ad"
    ],
    "action": "servicenow:get_table",
    "asynchronous": false
  },
  {
    "_id": "51401d50-f473-4e00-9538-f7ed329200ad",
    "name": "Found results?",
    "shortname": "condition",
    "type": "conditional_node",
    "playbook": "service_now_cmdb_enrichment",
    "errorStatus": "fail",
    "arguments": "{ \"expression\" : { \"inputType\" : \"bind\", \"schema\" : { \"type\" : \"boolean\" }, \"required\" : false, \"sensitive\" : false, \"runAsProject\" : true, \"expression\" : \"{ \\\"$and\\\" : [{ \\\"$isArray\\\" : \\\"$query_table.result.result\\\" }, { \\\"$gt\\\" : [{ \\\"$size\\\" : \\\"$query_table.result.result\\\" }, 0] }] }\" } }",
    "children": [
      "0036c6f8-de38-4fc3-9944-153f1a23ae77",
      "b236e3c7-366f-4a16-a2df-a06ff73a1567"
    ],
    "end": [
      "0036c6f8-de38-4fc3-9944-153f1a23ae77"
    ]
  },
  {
    "_id": "0036c6f8-de38-4fc3-9944-153f1a23ae77",
    "name": "End",
    "shortname": "end",
    "type": "end_node",
    "playbook": "service_now_cmdb_enrichment",
    "errorStatus": "fail"
  },
  {
    "_id": "b236e3c7-366f-4a16-a2df-a06ff73a1567",
    "name": "Insert CMDB data into sonargd.servicenow_cmdb_table_data",
    "shortname": "insert_data",
    "type": "action_node",
    "playbook": "service_now_cmdb_enrichment",
    "errorStatus": "fail",
    "arguments": "{ \"requestBody\" : { \"inputType\" : \"prompt\", \"schema\" : { \"type\" : \"object\", \"description\" : \"The action's parameters contained in the request data.\", \"extensions\" : { \"in\" : \"body\", \"mediaType\" : \"application/json\" }, \"required\" : [\"commands\"], \"properties\" : { \"commands\" : { \"type\" : \"array\", \"description\" : \"The list of command documents to run must be formatted like {\\\"command\\\": <\\\"some command\\\">, value: <value>, database_name: <db_name>, \\\"additional_parameters\\\": {arg1: <value>, arg2: <value>} }\", \"extensions\" : { \"parent\" : \"requestBody\" }, \"items\" : { } } } }, \"required\" : false, \"expanded\" : true, \"sensitive\" : false }, \"asset_id\" : { \"inputType\" : \"literal\", \"schema\" : { \"type\" : \"string\", \"description\" : \"The asset ID of the MongoDB server.\", \"extensions\" : { \"in\" : \"query\" } }, \"required\" : true, \"sensitive\" : false, \"value\" : \"\\\"lmrm__sonarw\\\"\" }, \"commands\" : { \"inputType\" : \"bind\", \"schema\" : { \"type\" : \"array\", \"description\" : \"The list of command documents to run must be formatted like {\\\"command\\\": <\\\"some command\\\">, value: <value>, database_name: <db_name>, \\\"additional_parameters\\\": {arg1: <value>, arg2: <value>} }\", \"extensions\" : { \"parent\" : \"requestBody\" }, \"items\" : { } }, \"required\" : true, \"sensitive\" : false, \"runAsProject\" : false, \"expression\" : \"[ { \\\"command\\\" : \\\"insert\\\", \\\"value\\\" : \\\"servicenow_cmdb_table_data\\\", \\\"database_name\\\" : \\\"sonargd\\\", \\\"additional_parameters\\\" : { \\\"documents\\\" : \\\"$query_table.result.result\\\" } } ]\" }, \"reason\" : { \"inputType\" : \"literal\", \"schema\" : { \"type\" : \"string\", \"description\" : \"Specify which connection to use for the given asset\", \"extensions\" : { \"in\" : \"query\" } }, \"required\" : false, \"sensitive\" : false, \"value\" : \"\\\"\\\"\" } }",
    "result": "{ \"schema\" : { \"type\" : \"object\", \"description\" : \"Action completed\", \"properties\" : { \"message\" : { \"type\" : \"string\", \"description\" : \"A message informing the update success and if any document was updated.\" }, \"output\" : { \"type\" : \"string\", \"description\" : \"A dictionary of commands and their output\" } } }, \"sensitive\" : false, \"expression\" : \"\" }",
    "children": [
      "0036c6f8-de38-4fc3-9944-153f1a23ae77"
    ],
    "action": "actions:sonaractions.mongodb_actions_run_mongodb_commands",
    "asynchronous": false
  }
]
